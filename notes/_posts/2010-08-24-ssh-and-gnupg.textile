---
layout: post
published: true
title: SSH and GnuPG
summary: Generating keys
tags: [ssh, gnupg]
time: "12:05"
---

h2. SSH and GnuPG

h3. Prepare .ssh folder
{% highlight bash %}
mkdir ~/.ssh
chmod 700 ~/.ssh

# for ssh connections multiplexing
mkdir ~/.ssh/connections
chmod 700 ~/.ssh/connections

touch ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys
touch ~/.ssh/config
chmod 600 ~/.ssh/config
touch ~/.ssh/known_hosts
chmod 600 ~/.ssh/known_hosts
{% endhighlight %}

h3. Generating SSH keys
{% highlight bash %}
$ ssh-keygen -t rsa -C "<me>@<email>"
Generating public/private rsa key pair.
Enter file in which to save the key (/home/Lauri/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /home/Lauri/.ssh/id_rsa.
Your public key has been saved in /home/Lauri/.ssh/id_rsa.pub.
{% endhighlight %}

h3. Convert SSH keys to GnuPG

{% highlight bash %}
# create a certificate for ssh key:
$ openssl req -new -x509 -key ~/.ssh/id_rsa -out ~/.ssh/id_rsa.pem
# import it in GnuPG
$ openssl pkcs12 -export -in ~/.ssh/id_rsa.pem -inkey ~/.ssh/id_rsa -out ~/.ssh/id_rsa.p12
$ gpg --import ~/.ssh/id_rsa.p12

h3. More permissions

chmod 700 ~/.gnupg

chmod 600 ~/.ssh/id_rsa
chmod 644 ~/.ssh/id_rsa.pub  

cat ~/.ssh/id_rsa.pub | ssh remotehost "cat > .ssh/authorized_keys; chmod 600 .ssh/authorized_keys"
ssh-copy-id -i ~/.ssh/id_rsa.pub remotehost
