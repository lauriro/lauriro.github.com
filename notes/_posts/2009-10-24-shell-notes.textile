---
layout: post
title: Shell notes
summary: .
tags: [shell, ssh, tar]
---

h2(#coping). Coping files

{% highlight bash %}

Given:
foo=/tmp/my.dir/filename.tar.gz 

We can use these expressions:
path = ${foo%/*}
To get: /tmp/my.dir (like dirname)
file = ${foo##*/}
To get: filename.tar.gz (like basename)
base = ${file%%.*}
To get: filename 
ext = ${file#*.}
To get: tar.gz 

tar czf - /path/directory_to_get | ssh user@host "cat > /path/data.tgz" 
tar czf - /path/directory_to_get | ssh user@host tar xzf - -C /path/

ssh user@host "tar czf - /path/directory_to_get" | cat > /path/data.tgz
ssh user@host "tar czf - /path/directory_to_get" | tar xzvf - -C /path/
{% endhighlight %}

h2(#database). Loops

{% highlight bash %}
for f in *.erl ; do erlc +debug_info -o ../ebin $f; done
for (( c=1; c<=5; c++ )); do echo "Welcome $c times..."; done
{% endhighlight %}


h2(#database). Database

{% highlight bash %}
mysqldump --quick -u user -p pass -h host database | mysql -u user -p pass -P port -h host

ssh user@host "mysqldump -u user -p pass -h sqlhost database | gzip -cf9" | cat > /path/database.gz

mysql -u user -p pass < query.sql > result.txt
{% endhighlight %}

h2(#permissions). File system permissions

{% highlight bash %}
find /www -type d -print0 | xargs -0 chmod 0755
find /www -type f -print0 | xargs -0 chmod 0644

ls -1 -b | grep \.avi | while read FILE; do mkdir "${FILE%%.avi}"; mv "$FILE" "${FILE%%.avi}"; done
find ./ | grep \.dropbox | while read FILE; do rm "$FILE"; done

{% endhighlight %}


ps -wax -o rss= -p `pgrep -f 'php-cgi'` | awk 'BEGIN {s=0}{s = s + $1} END {print "Total memory used: " s "K"}'
grep "?mod=update" access.log | awk 'BEGIN {s=0} { s+=1; print $4,$5 " - " $1 " - asukoht: " $11 } END { print "-\nKokku leitud ridu:", s ,"\n-"}'
curl -d '{"method":"evlog_insert","params":[{"evcode":"test","origin":"web","ts":123,"ids":[1,3,5] }]}' http://192.168.1.193:8000/json-rpc

http://sourceforge.net/projects/console/